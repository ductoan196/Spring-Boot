<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/layout_dashboard_partner :: main-fragment(
                                                ~{:: title},
                                                ~{:: #css-resources},
                                                ~{:: #js-resources},
                                                ~{:: #main-content}
                                               )}">

<head>

    <title>Partner Dashboard</title>

    <th:block id="css-resources">

    </th:block>
</head>

<body>

<main id="main-content">
    <div class="page-content">

        <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="mb-4">Hotel Information</h4>
                        <div class="container">
                            <div class="row my-t bs">
                                <div class="col d-flex justify-content-center">
                                    <img id="avatar-hotel" class="rounded-circle" style="width: 150px; height: 150px" alt="Avatar"
                                         src="/assets/user/images/default-avatar.png"/>

                                </div>
                                <div class="row mt-2 mx-0">
                                    <div class="col d-flex justify-content-center">
                                        <button class="btn btn-sm change-avatar-hotel" style="border: 0.5px solid grey">
                                            <i class="link-icon p-1" data-feather="upload"></i> Upload avatar</button>
                                        <button class="btn btn-sm btn-success submit-avatar-btn ml-1" hidden="hidden">Save</button>
                                    </div>
                                </div>

                            </div>
                            <form class="forms-sample mt-3">
                                <div class="row">
                                    <input type="file" hidden="hidden" id="avatar-input-hotel"/>
                                    <div class="col-lg-6 mb-3">
                                        <label for="fullname" class="form-label"> Full Name</label>
                                        <input type="text" class="form-control" id="fullname" autocomplete="off"
                                               placeholder>
                                    </div>
                                    <div class="col-lg-6 mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" autocomplete="off"
                                               placeholder>
                                    </div>
                                    <div class="col-lg-6 mb-3">
                                        <label for="phone" class="form-label">Phone No.</label>
                                        <input type="number" class="form-control" id="phone" autocomplete="off"
                                               placeholder>
                                    </div>

                                    <div class="col-lg-6 mb-3">
                                        <label for="address" class="form-label"> Address</label>
                                        <input type="text" class="form-control" id="address" autocomplete="off"
                                               placeholder>
                                    </div>


                                    <div class="col-lg-6 mb-3">
                                        <label for="gender" class="form-label">Gender</label>
                                        <select class="form-select" id="gender" name="gender">
                                            <option th:each="gender : ${genders}" th:value="${gender}" th:text="${gender.name}"></option>
                                        </select>
                                    </div>


                                    <div class="text-right pt-4">
                                        <button type="submit" class="btn btn-primary submit-hotel-profile-btn"><i class="link-icon"
                                                                                         data-feather="save"></i> Save Profile</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</main>

<th:block id="js-resources">
    <script src="assets/user/js/modify-profile.js"></script>

    <script>
        $(document).ready(function () {
            let userInfo = JSON.parse(localStorage.getItem("userInfo"))
            let emailInput = document.getElementById('email');
            emailInput.value = userInfo.username;
            emailInput.readOnly= true;


            function getHotelByEmail(email) {
                const jwt = localStorage.getItem('jwt');
                let emailHotel = userInfo.username
                if (jwt) {
                    $.ajax({
                        url: '/api/v1/partner/hotel/' + emailHotel,
                        type: 'GET',
                        headers: {
                            'Authorization': 'Bearer ' + jwt
                        },
                        success: function (response) {
                            // Xử lý dữ liệu khách sạn nhận được từ response
                            console.log(response);
                            // Hiển thị thông tin khách sạn trong giao diện
                            $('#hotelName').text(response.name);
                            $('#hotelAddress').text(response.address);
                            // Các thông tin khác của khách sạn
                        },
                        error: function (xhr, status, error) {
                            console.error(error);
                        }
                    });
                }
            }


            // toastr.options.timeOut = 2500; // 2.5s
            let chosenFile = null;

            $(".change-avatar-hotel").click(() => {
                $("#avatar-input-hotel").click();
            });

            $("#avatar-input-hotel").change(event => {
                const tempFiles = event.target.files;
                if (!tempFiles || tempFiles.length === 0) {
                    return;
                }
                console.log(event.target.files[0].data);
                chosenFile = tempFiles[0];

                const imageBlob = new Blob([chosenFile], {type: chosenFile.type});
                const imageUrl = URL.createObjectURL(imageBlob);
                $("#avatar-hotel").attr("src", imageUrl);
            });

            $(".submit-hotel-profile-btn").click(() => {
                if (!chosenFile) {
                    toastr.error("Chưa chọn file");
                    return;
                }

                const formData = new FormData();
                formData.append('avatar', chosenFile);
                $.ajax({
                    url: '/api/v1/users/avatar',
                    data: formData,
                    type: 'POST',
                    contentType: false, // NEEDED, DON'T OMIT THIS (requires jQuery 1.6+)
                    processData: false, // NEEDED, DON'T OMIT THIS
                    success: function (data) {
                        console.log(data);
                        toastr.success(data);
                    },
                    error: function (errorData) {
                        console.log(errorData);
                        toastr.error(errorData);
                    }
                });
            });

        });
    </script>
</th:block>
</body>

</html>